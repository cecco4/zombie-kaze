<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Zombie-Kaze: Riferimenti per il file raycast.cc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Zombie-Kaze
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generato da Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Cerca');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Pagina&#160;Principale</span></a></li>
      <li><a href="annotated.html"><span>Classi</span></a></li>
      <li class="current"><a href="files.html"><span>File</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Cerca" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>Elenco&#160;dei&#160;file</span></a></li>
      <li><a href="globals.html"><span>Elementi&#160;dei&#160;file</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>Tutto</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classi</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>File</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Funzioni</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variabili</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Tipi enumerati (enum)</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Valori del tipo enumerato</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Definizioni</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pagine</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Definizioni</a> &#124;
<a href="#func-members">Funzioni</a>  </div>
  <div class="headertitle">
<div class="title">Riferimenti per il file raycast.cc</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;iostream&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;allegro5/allegro.h&gt;</code><br/>
<code>#include &lt;allegro5/allegro_image.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="struttura__dati_8h_source.html">struttura_dati.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="raycast_8h_source.html">raycast.h</a>&quot;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Definizioni</h2></td></tr>
<tr class="memitem:a525335710b53cb064ca56b936120431e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#a525335710b53cb064ca56b936120431e">_USE_MATH_DEFINES</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Funzioni</h2></td></tr>
<tr class="memitem:ac84354a5d9d83509fa701d4bc251e0ae"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#ac84354a5d9d83509fa701d4bc251e0ae">sort_nemici</a> (int a[], int n, <a class="el" href="structnemici__dat.html">nemici_dat</a> &amp;nem)</td></tr>
<tr class="memdesc:ac84354a5d9d83509fa701d4bc251e0ae"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ordina i nemici in base alla distanza dal giocatore.  <a href="#ac84354a5d9d83509fa701d4bc251e0ae"></a><br/></td></tr>
<tr class="memitem:aa15f09960181b3e9f70492ff01c2bb81"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#aa15f09960181b3e9f70492ff01c2bb81">alpha_cmp</a> (ALLEGRO_COLOR c)</td></tr>
<tr class="memdesc:aa15f09960181b3e9f70492ff01c2bb81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Ritorna true se il colore dato per parametro è uguale al colore usato per identificare la trasparenza di una immagine.  <a href="#aa15f09960181b3e9f70492ff01c2bb81"></a><br/></td></tr>
<tr class="memitem:a66cd3c9531caaf3edd8212d0450c5b06"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#a66cd3c9531caaf3edd8212d0450c5b06">disegna_sprite</a> (int n, <a class="el" href="structplayer__dat.html">player_dat</a> &amp;pl, <a class="el" href="structnemici__dat.html">nemici_dat</a> &amp;nem, <a class="el" href="structmappa__dat.html">mappa_dat</a> &amp;map, int zbuffer[], ALLEGRO_COLOR render[][<a class="el" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b">lschermo</a>])</td></tr>
<tr class="memdesc:a66cd3c9531caaf3edd8212d0450c5b06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disegna le sprite dei nemici sulla render matrix.  <a href="#a66cd3c9531caaf3edd8212d0450c5b06"></a><br/></td></tr>
<tr class="memitem:af17327e8f30901ed070fd9413dfc331a"><td class="memItemLeft" align="right" valign="top">static ALLEGRO_COLOR&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#af17327e8f30901ed070fd9413dfc331a">effetto_distanza</a> (ALLEGRO_COLOR col, double dist)</td></tr>
<tr class="memdesc:af17327e8f30901ed070fd9413dfc331a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Conferisce un effetto di distanza ai muri scurendoli.  <a href="#af17327e8f30901ed070fd9413dfc331a"></a><br/></td></tr>
<tr class="memitem:a5b4615cd4bb62c1c29dfd7e3bb2a3739"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#a5b4615cd4bb62c1c29dfd7e3bb2a3739">to_360</a> (double ang)</td></tr>
<tr class="memdesc:a5b4615cd4bb62c1c29dfd7e3bb2a3739"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dato un numero lo riporta ad un intervallo fra 0 e 360.  <a href="#a5b4615cd4bb62c1c29dfd7e3bb2a3739"></a><br/></td></tr>
<tr class="memitem:ac2200150c9f43d15c533f992f37b5f96"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#ac2200150c9f43d15c533f992f37b5f96">rad</a> (double ang)</td></tr>
<tr class="memdesc:ac2200150c9f43d15c533f992f37b5f96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dato un angolo in gradi lo converte in radianti.  <a href="#ac2200150c9f43d15c533f992f37b5f96"></a><br/></td></tr>
<tr class="memitem:a8d44f8f8e008d0cde33d2c3d6977f62f"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#a8d44f8f8e008d0cde33d2c3d6977f62f">grad</a> (double ang)</td></tr>
<tr class="memdesc:a8d44f8f8e008d0cde33d2c3d6977f62f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dato un angolo in radianti lo converte in gradi.  <a href="#a8d44f8f8e008d0cde33d2c3d6977f62f"></a><br/></td></tr>
<tr class="memitem:a90e8e16b79daf4b918e5535a026e57ed"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#a90e8e16b79daf4b918e5535a026e57ed">raycast</a> (<a class="el" href="structplayer__dat.html">player_dat</a> &amp;pl, <a class="el" href="structnemici__dat.html">nemici_dat</a> &amp;nem, <a class="el" href="structmappa__dat.html">mappa_dat</a> &amp;map, <a class="el" href="structtexture__dat.html">texture_dat</a> *texture, ALLEGRO_COLOR render[][<a class="el" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b">lschermo</a>])</td></tr>
<tr class="memdesc:a90e8e16b79daf4b918e5535a026e57ed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Funzione principale per quanto concerne la grafica del gioco.  <a href="#a90e8e16b79daf4b918e5535a026e57ed"></a><br/></td></tr>
<tr class="memitem:a04851c30cecc4ffff04b48e05531f231"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#a04851c30cecc4ffff04b48e05531f231">pulisci_render_matrix</a> (ALLEGRO_COLOR render_matrix[<a class="el" href="struttura__dati_8h.html#af660130ebbf343c65c1bdcbb8fa23cbf">hschermo</a>][<a class="el" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b">lschermo</a>])</td></tr>
<tr class="memdesc:a04851c30cecc4ffff04b48e05531f231"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pulisce la matrice utilizzata per il rendering, preparandola quindi ad essere plasmata da <a class="el" href="raycast_8h.html#a90e8e16b79daf4b918e5535a026e57ed" title="Funzione principale per quanto concerne la grafica del gioco.">raycast</a>.  <a href="#a04851c30cecc4ffff04b48e05531f231"></a><br/></td></tr>
<tr class="memitem:aa247b5ff21e7bf49cfb5e87c2db6fc99"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="raycast_8cc.html#aa247b5ff21e7bf49cfb5e87c2db6fc99">applica_render_matrix</a> (ALLEGRO_COLOR render_matrix[<a class="el" href="struttura__dati_8h.html#af660130ebbf343c65c1bdcbb8fa23cbf">hschermo</a>][<a class="el" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b">lschermo</a>], ALLEGRO_BITMAP *rendering)</td></tr>
<tr class="memdesc:aa247b5ff21e7bf49cfb5e87c2db6fc99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Trasforma la matrice di colori in immagine che verrà poi disegnata sul display dal <a class="el" href="main_8cc.html#a840291bc02cba5474a4cb46a9b9566fe" title="Funzione principale.">main</a>.  <a href="#aa247b5ff21e7bf49cfb5e87c2db6fc99"></a><br/></td></tr>
</table>
<h2>Documentazione delle definizioni</h2>
<a class="anchor" id="a525335710b53cb064ca56b936120431e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _USE_MATH_DEFINES</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2>Documentazione delle funzioni</h2>
<a class="anchor" id="aa15f09960181b3e9f70492ff01c2bb81"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool alpha_cmp </td>
          <td>(</td>
          <td class="paramtype">ALLEGRO_COLOR&#160;</td>
          <td class="paramname"><em>c</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Ritorna true se il colore dato per parametro è uguale al colore usato per identificare la trasparenza di una immagine. </p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span> (c.r == 1 &amp;&amp; c.g == 0 &amp;&amp; c.b == 1)</div>
<div class="line">                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa247b5ff21e7bf49cfb5e87c2db6fc99"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void applica_render_matrix </td>
          <td>(</td>
          <td class="paramtype">ALLEGRO_COLOR&#160;</td>
          <td class="paramname"><em>render_matrix</em>[hschermo][lschermo], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ALLEGRO_BITMAP *&#160;</td>
          <td class="paramname"><em>rendering</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Trasforma la matrice di colori in immagine che verrà poi disegnata sul display dal <a class="el" href="main_8cc.html#a840291bc02cba5474a4cb46a9b9566fe" title="Funzione principale.">main</a>. </p>
<p>Parametri: render_matrix matrice per il rendering Parametri: rendering immagine finale </p>
<div class="fragment"><div class="line">{</div>
<div class="line">        al_lock_bitmap(rendering, ALLEGRO_PIXEL_FORMAT_ANY, ALLEGRO_LOCK_WRITEONLY);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="struttura__dati_8h.html#af660130ebbf343c65c1bdcbb8fa23cbf" title="Altezza dello schermo.">hschermo</a>; i++) </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b" title="Larghezza dello schermo.">lschermo</a>; j++) {</div>
<div class="line">                </div>
<div class="line">                        al_put_pixel(j, i,      render_matrix[i][j] );                  </div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        al_unlock_bitmap(rendering);    </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a66cd3c9531caaf3edd8212d0450c5b06"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void disegna_sprite </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structplayer__dat.html">player_dat</a> &amp;&#160;</td>
          <td class="paramname"><em>pl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structnemici__dat.html">nemici_dat</a> &amp;&#160;</td>
          <td class="paramname"><em>nem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structmappa__dat.html">mappa_dat</a> &amp;&#160;</td>
          <td class="paramname"><em>map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>zbuffer</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ALLEGRO_COLOR&#160;</td>
          <td class="paramname"><em>render</em>[][lschermo]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Disegna le sprite dei nemici sulla render matrix. </p>
<div class="fragment"><div class="line">{       </div>
<div class="line">        <span class="keywordtype">double</span> xsprite = nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n].<a class="code" href="structnemico__dat.html#a8671e18e611267e6f5a0a33a0aa96371" title="Coordinata x.">x</a>;</div>
<div class="line">        <span class="keywordtype">double</span> ysprite = nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n].<a class="code" href="structnemico__dat.html#ae77c14ff4bea0943f352d4f7eec20ddb" title="Coordinata y.">y</a>;       </div>
<div class="line">        <span class="keywordtype">int</span> l = map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>;</div>
<div class="line">                        </div>
<div class="line">        <span class="keywordtype">double</span> dx = xsprite - pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a>;</div>
<div class="line">        <span class="keywordtype">double</span> dy = ysprite - pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a>;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">double</span> spr_ang = <a class="code" href="raycast_8cc.html#a5b4615cd4bb62c1c29dfd7e3bb2a3739" title="Dato un numero lo riporta ad un intervallo fra 0 e 360.">to_360</a>(<a class="code" href="raycast_8cc.html#a8d44f8f8e008d0cde33d2c3d6977f62f" title="Dato un angolo in radianti lo converte in gradi.">grad</a>(atan2(dy, dx))+pl.<a class="code" href="structplayer__dat.html#ae51ef04fa403d4694a36380e54b3148d" title="Angolo in gradi.">ang</a>+pl.<a class="code" href="structplayer__dat.html#ac9b0f334d439e2ad54db873406489f62" title="Field of view del giocatore.">fov</a>);     </div>
<div class="line">                </div>
<div class="line">        <span class="keywordtype">double</span> dists = nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n].<a class="code" href="structnemico__dat.html#a4df41dde8f4d6a21750610b919487484" title="Distanza dal giocatore.">dist</a> - fabs(pl.<a class="code" href="structplayer__dat.html#ac9b0f334d439e2ad54db873406489f62" title="Field of view del giocatore.">fov</a>-spr_ang)/3 ;</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">double</span> lproj =  (l/ dists) * <a class="code" href="struttura__dati_8h.html#ac135773066aa5d3223927deba36fdb2c" title="distanza del piano di proiezione dallo schermo">dist_schermo</a>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">int</span> posx = (spr_ang-pl.<a class="code" href="structplayer__dat.html#ac9b0f334d439e2ad54db873406489f62" title="Field of view del giocatore.">fov</a>/2)*<a class="code" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b" title="Larghezza dello schermo.">lschermo</a> / pl.<a class="code" href="structplayer__dat.html#ac9b0f334d439e2ad54db873406489f62" title="Field of view del giocatore.">fov</a>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">double</span> hs = (l / dists) * <a class="code" href="struttura__dati_8h.html#ac135773066aa5d3223927deba36fdb2c" title="distanza del piano di proiezione dallo schermo">dist_schermo</a>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (lproj&lt;= 0 || lproj&gt;<a class="code" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b" title="Larghezza dello schermo.">lschermo</a>*2 || hs&lt;=0 || hs&gt;<a class="code" href="struttura__dati_8h.html#af660130ebbf343c65c1bdcbb8fa23cbf" title="Altezza dello schermo.">hschermo</a>*2)</div>
<div class="line">                <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=0; j&lt;lproj/2;j++) {</div>
<div class="line">        </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;hs; k++) {</div>
<div class="line">                </div>
<div class="line">                        <span class="keywordtype">int</span> posy = hschermo/2 - hs/2 +k;                </div>
<div class="line">                </div>
<div class="line">                        <span class="keywordflow">if</span> ( posy&lt;hschermo &amp;&amp; posy&gt;=0) {</div>
<div class="line">                                <span class="keywordtype">int</span> xoff = int(j*l/lproj) ;</div>
<div class="line">                                <span class="keywordtype">int</span> yoff = int(k*l/hs) %l;</div>
<div class="line">                                <span class="keywordtype">int</span> frame = nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n].<a class="code" href="structnemico__dat.html#a0da2ca593351036cd4ce45c5d5d3dc34" title="Frame attuale dell&#39;animazione.">frame</a>; </div>
<div class="line">                                        </div>
<div class="line">                                <span class="keywordflow">if</span> (zbuffer[posx+j]&gt;dists &amp;&amp; posx+j&lt;lschermo &amp;&amp; posx+j&gt;=0 ) {</div>
<div class="line">                                        </div>
<div class="line">                                        ALLEGRO_COLOR col = nem.<a class="code" href="structnemici__dat.html#ad3760d45d329954d5211f392cc7e1120" title="Sprite dei nemici.">text</a>[frame].<a class="code" href="structtexture__dat.html#a2d4e329432e9f424959bdb18c1b92c42" title="Matrice di colori, ovvero l&#39; immagine.">img</a>[yoff][32+xoff]; </div>
<div class="line">                                        <span class="keywordflow">if</span> (<a class="code" href="raycast_8cc.html#aa15f09960181b3e9f70492ff01c2bb81" title="Ritorna true se il colore dato per parametro è uguale al colore usato per identificare la trasparenza...">alpha_cmp</a>(col))</div>
<div class="line">                                                render[posy][posx+j] = <a class="code" href="raycast_8cc.html#af17327e8f30901ed070fd9413dfc331a" title="Conferisce un effetto di distanza ai muri scurendoli.">effetto_distanza</a>(col,dists); </div>
<div class="line">                                }</div>
<div class="line">                                <span class="keywordflow">if</span> (zbuffer[posx-j]&gt;dists &amp;&amp; posx-j&gt;=0 &amp;&amp; posx-j &lt;<a class="code" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b" title="Larghezza dello schermo.">lschermo</a>) {</div>
<div class="line">                                        </div>
<div class="line">                                        ALLEGRO_COLOR col = nem.<a class="code" href="structnemici__dat.html#ad3760d45d329954d5211f392cc7e1120" title="Sprite dei nemici.">text</a>[frame].<a class="code" href="structtexture__dat.html#a2d4e329432e9f424959bdb18c1b92c42" title="Matrice di colori, ovvero l&#39; immagine.">img</a>[yoff][31-xoff];</div>
<div class="line">                                        <span class="keywordflow">if</span> (<a class="code" href="raycast_8cc.html#aa15f09960181b3e9f70492ff01c2bb81" title="Ritorna true se il colore dato per parametro è uguale al colore usato per identificare la trasparenza...">alpha_cmp</a>(col))</div>
<div class="line">                                                render[posy][posx-j] = <a class="code" href="raycast_8cc.html#af17327e8f30901ed070fd9413dfc331a" title="Conferisce un effetto di distanza ai muri scurendoli.">effetto_distanza</a>(col,dists); </div>
<div class="line">                                }</div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af17327e8f30901ed070fd9413dfc331a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ALLEGRO_COLOR effetto_distanza </td>
          <td>(</td>
          <td class="paramtype">ALLEGRO_COLOR&#160;</td>
          <td class="paramname"><em>col</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>dist</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Conferisce un effetto di distanza ai muri scurendoli. </p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">double</span> blend = dist*2/1000; </div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> (blend&gt;1) {</div>
<div class="line">                col.r /= blend;</div>
<div class="line">                col.g /= blend;</div>
<div class="line">                col.b /= blend;         </div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> col;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8d44f8f8e008d0cde33d2c3d6977f62f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double grad </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ang</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dato un angolo in radianti lo converte in gradi. </p>
<p>Parametri: ang angolo </p>
<div class="fragment"><div class="line">{       </div>
<div class="line">        <span class="keywordflow">return</span> ang / M_PI * 180.0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a04851c30cecc4ffff04b48e05531f231"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pulisci_render_matrix </td>
          <td>(</td>
          <td class="paramtype">ALLEGRO_COLOR&#160;</td>
          <td class="paramname"><em>render_matrix</em>[hschermo][lschermo]</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pulisce la matrice utilizzata per il rendering, preparandola quindi ad essere plasmata da <a class="el" href="raycast_8h.html#a90e8e16b79daf4b918e5535a026e57ed" title="Funzione principale per quanto concerne la grafica del gioco.">raycast</a>. </p>
<p>Parametri: render_matrix matrice per il rendering </p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="struttura__dati_8h.html#af660130ebbf343c65c1bdcbb8fa23cbf" title="Altezza dello schermo.">hschermo</a>; i++)</div>
<div class="line">                <span class="keywordflow">for</span>( <span class="keywordtype">int</span> j=0; j&lt;<a class="code" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b" title="Larghezza dello schermo.">lschermo</a>; j++)  </div>
<div class="line">                        render_matrix[i][j] = al_map_rgb(0,0,0);</div>
<div class="line"></div>
<div class="line">        </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac2200150c9f43d15c533f992f37b5f96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double rad </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ang</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dato un angolo in gradi lo converte in radianti. </p>
<p>Parametri: ang angolo </p>
<div class="fragment"><div class="line">{       </div>
<div class="line">        <span class="keywordflow">return</span> ang* M_PI / 180.0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a90e8e16b79daf4b918e5535a026e57ed"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void raycast </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structplayer__dat.html">player_dat</a> &amp;&#160;</td>
          <td class="paramname"><em>pl</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structnemici__dat.html">nemici_dat</a> &amp;&#160;</td>
          <td class="paramname"><em>nem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structmappa__dat.html">mappa_dat</a> &amp;&#160;</td>
          <td class="paramname"><em>map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structtexture__dat.html">texture_dat</a> *&#160;</td>
          <td class="paramname"><em>texture</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ALLEGRO_COLOR&#160;</td>
          <td class="paramname"><em>render</em>[][lschermo]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Funzione principale per quanto concerne la grafica del gioco. </p>
<p>Questa funzione in base alla mappa, costruisce una visuale in falso 3d dell'ambiente circostante. Disegna i muri con una tecnica chiamata appunto raycasting, dopodichè aggiunge i nemici appoggiandosi a <a class="el" href="raycast_8cc.html#a66cd3c9531caaf3edd8212d0450c5b06" title="Disegna le sprite dei nemici sulla render matrix.">disegna_sprite</a> .</p>
<p>Parametri: pl dati del giocatore Parametri: nem dati dei nemici Parametri: map dati della mappa Parametri: texture texture dei muri Parametri: render matrice sulla quale verranno applicate tutta la visuale grafica calcolata nella funzione </p>
<div class="fragment"><div class="line">{</div>
<div class="line">        </div>
<div class="line">        <span class="comment">//vettore che conterrà tutte le distanze dei muri</span></div>
<div class="line">        <span class="keywordtype">int</span> zbuffer[<a class="code" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b" title="Larghezza dello schermo.">lschermo</a>];  </div>
<div class="line">        </div>
<div class="line">        <span class="comment">//vettore che conterrà tutti i blocchi in cui passeranno i raggi</span></div>
<div class="line">        <span class="keywordtype">bool</span> blocchi_in_vista[map.<a class="code" href="structmappa__dat.html#af68162fa4ba3dbcbfe4691f0d692e791" title="Numero blocchi per lato della mappa.">dim</a>][map.<a class="code" href="structmappa__dat.html#af68162fa4ba3dbcbfe4691f0d692e791" title="Numero blocchi per lato della mappa.">dim</a>];  </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;map.<a class="code" href="structmappa__dat.html#af68162fa4ba3dbcbfe4691f0d692e791" title="Numero blocchi per lato della mappa.">dim</a>; i++) <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;map.<a class="code" href="structmappa__dat.html#af68162fa4ba3dbcbfe4691f0d692e791" title="Numero blocchi per lato della mappa.">dim</a>; j++)</div>
<div class="line">                blocchi_in_vista[i][j] = <span class="keyword">false</span>;</div>
<div class="line"></div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="struttura__dati_8h.html#a0784cd492c479dda0e0cb343eb420c0b" title="Larghezza dello schermo.">lschermo</a>; i++) {</div>
<div class="line">                <span class="comment">//calcolo angolo del raggio (in gradi)</span></div>
<div class="line">                <span class="keywordtype">double</span> angray = <a class="code" href="raycast_8cc.html#a5b4615cd4bb62c1c29dfd7e3bb2a3739" title="Dato un numero lo riporta ad un intervallo fra 0 e 360.">to_360</a>( pl.<a class="code" href="structplayer__dat.html#ae51ef04fa403d4694a36380e54b3148d" title="Angolo in gradi.">ang</a> + pl.<a class="code" href="structplayer__dat.html#ac9b0f334d439e2ad54db873406489f62" title="Field of view del giocatore.">fov</a>/2 - (pl.<a class="code" href="structplayer__dat.html#ac9b0f334d439e2ad54db873406489f62" title="Field of view del giocatore.">fov</a>/lschermo)*i );</div>
<div class="line">                <span class="keywordtype">double</span> tg_ang = tan(<a class="code" href="raycast_8cc.html#ac2200150c9f43d15c533f992f37b5f96" title="Dato un angolo in gradi lo converte in radianti.">rad</a>(angray)); <span class="comment">// si usa spesso quindi risparmio   </span></div>
<div class="line"></div>
<div class="line">                <span class="comment">//direzione raggio</span></div>
<div class="line">                <span class="keywordtype">bool</span> <a class="code" href="logica__gioco_8cc.html#a77d32c22115115152439406d75895b2da993c8ae02a4eb216e79975d9c4b30ba7">su</a>, dx;     </div>
<div class="line">                <span class="keywordflow">if</span> (angray &gt; 0 &amp;&amp; angray &lt; 180)    </div>
<div class="line">                        su = <span class="keyword">true</span>;</div>
<div class="line">                <span class="keywordflow">else</span> </div>
<div class="line">                        su = <span class="keyword">false</span>;    <span class="comment">//  !su = giù</span></div>
<div class="line">                        </div>
<div class="line">                <span class="keywordflow">if</span> (angray &gt; 90 &amp;&amp; angray &lt; 270)</div>
<div class="line">                        dx = <span class="keyword">false</span>;        <span class="comment">//  !dx = sx </span></div>
<div class="line">                <span class="keywordflow">else</span> </div>
<div class="line">                        dx = <span class="keyword">true</span>;      </div>
<div class="line">                        </div>
<div class="line"></div>
<div class="line">                <span class="comment">//intersezioni orrizzontali</span></div>
<div class="line">                <span class="keywordtype">double</span> xo, yo;          <span class="comment">//punto prima intersezione</span></div>
<div class="line">                <span class="keywordflow">if</span> (su) </div>
<div class="line">                        yo = pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a> - (fmod(pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a>, map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>));</div>
<div class="line">                <span class="keywordflow">else</span> </div>
<div class="line">                        yo = pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a> - (fmod(pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a>, map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)) + map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>;</div>
<div class="line">                        </div>
<div class="line">                xo = pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a> + (pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a> - yo) / tg_ang;</div>
<div class="line">                </div>
<div class="line">                <span class="keywordtype">double</span> xs,ys; <span class="comment">// variabili step</span></div>
<div class="line">                xs= map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a> / tg_ang;</div>
<div class="line">                        </div>
<div class="line">                <span class="keywordflow">if</span> (su) </div>
<div class="line">                        ys = -map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>; </div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                        ys = map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>; </div>
<div class="line">                        xs = -xs;</div>
<div class="line">                }</div>
<div class="line">                </div>
<div class="line">                <span class="keywordtype">int</span> tile_o;</div>
<div class="line">                <span class="keywordflow">while</span>(  yo/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a> &gt;= 0  &amp;&amp; yo/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>&lt;map.<a class="code" href="structmappa__dat.html#af68162fa4ba3dbcbfe4691f0d692e791" title="Numero blocchi per lato della mappa.">dim</a>  &amp;&amp;</div>
<div class="line">                                xo/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a> &gt;= 0  &amp;&amp; xo/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>&lt;map.<a class="code" href="structmappa__dat.html#af68162fa4ba3dbcbfe4691f0d692e791" title="Numero blocchi per lato della mappa.">dim</a>      ) {</div>
<div class="line">                                </div>
<div class="line">                        tile_o = map.<a class="code" href="structmappa__dat.html#aa8812a67b74b6433219812c8b95ae2cb" title="matrice dinamica che contiene le informazioni sulla locazione dei muri">data</a>[int(yo/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)-1*<a class="code" href="logica__gioco_8cc.html#a77d32c22115115152439406d75895b2da993c8ae02a4eb216e79975d9c4b30ba7">su</a>][int(xo/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)];</div>
<div class="line">                        </div>
<div class="line">                        <span class="keywordflow">if</span> (tile_o != 0)</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                        </div>
<div class="line">                        blocchi_in_vista[int(yo/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)-1*<a class="code" href="logica__gioco_8cc.html#a77d32c22115115152439406d75895b2da993c8ae02a4eb216e79975d9c4b30ba7">su</a>][int(xo/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)] = <span class="keyword">true</span>;  </div>
<div class="line">                                </div>
<div class="line">                        xo += xs;</div>
<div class="line">                        yo += ys;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                </div>
<div class="line">                <span class="comment">//intersezioni verticali</span></div>
<div class="line">                <span class="keywordtype">double</span> xv, yv;          <span class="comment">//punto prima intersezione</span></div>
<div class="line">                <span class="keywordflow">if</span> (dx)</div>
<div class="line">                        xv = pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a> - (fmod(pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a>, map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)) + map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>;</div>
<div class="line">                <span class="keywordflow">else</span></div>
<div class="line">                        xv = pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a> - (fmod(pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a>, map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>));</div>
<div class="line"></div>
<div class="line">                yv = pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a> + (pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a> - xv) * tg_ang;</div>
<div class="line">                </div>
<div class="line">                </div>
<div class="line">                <span class="comment">//variabili step</span></div>
<div class="line">                ys = map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a> * tg_ang;</div>
<div class="line">                        </div>
<div class="line">                <span class="keywordflow">if</span> (dx) {</div>
<div class="line">                        xs = map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>;</div>
<div class="line">                        ys = -ys;</div>
<div class="line">                } <span class="keywordflow">else</span></div>
<div class="line">                        xs = -map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordtype">int</span> tile_v;             </div>
<div class="line">                <span class="keywordflow">while</span>(  yv/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a> &gt;= 0  &amp;&amp; yv/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>&lt;map.<a class="code" href="structmappa__dat.html#af68162fa4ba3dbcbfe4691f0d692e791" title="Numero blocchi per lato della mappa.">dim</a>  &amp;&amp;</div>
<div class="line">                                xv/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a> &gt;= 0  &amp;&amp; xv/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>&lt;map.<a class="code" href="structmappa__dat.html#af68162fa4ba3dbcbfe4691f0d692e791" title="Numero blocchi per lato della mappa.">dim</a>              ) {</div>
<div class="line">                </div>
<div class="line">                        tile_v = map.<a class="code" href="structmappa__dat.html#aa8812a67b74b6433219812c8b95ae2cb" title="matrice dinamica che contiene le informazioni sulla locazione dei muri">data</a>[int(yv/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)][int(xv/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)-1*!dx];          </div>
<div class="line">                        </div>
<div class="line">                        <span class="keywordflow">if</span> (tile_v != 0)</div>
<div class="line">                                <span class="keywordflow">break</span>;</div>
<div class="line">                                </div>
<div class="line">                        blocchi_in_vista[int(yv/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)][int(xv/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)-1*!dx] = <span class="keyword">true</span>;  </div>
<div class="line">                                </div>
<div class="line">                        xv += xs;</div>
<div class="line">                        yv += ys;</div>
<div class="line">                }        </div>
<div class="line"></div>
<div class="line">                </div>
<div class="line">                <span class="comment">//calcolo distanze intersezioni</span></div>
<div class="line">                <span class="keywordtype">double</span> d_orr =  pow(pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a> - xo,2) + pow (pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a> - yo,2);</div>
<div class="line">                <span class="keywordtype">double</span> d_vert =  pow(pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a> - xv,2) + pow (pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a> - yv,2);</div>
<div class="line">        </div>
<div class="line">                </div>
<div class="line">                <span class="keywordtype">double</span> dist;</div>
<div class="line">                <span class="keywordtype">bool</span> shade=<span class="keyword">false</span>; </div>
<div class="line">                <span class="keywordtype">int</span> off; <span class="comment">//offset texture</span></div>
<div class="line">                <span class="keywordtype">int</span> ntile;</div>
<div class="line">                 </div>
<div class="line">                <span class="comment">//prendo la dist minore</span></div>
<div class="line">                <span class="keywordflow">if</span> (d_orr &lt; d_vert) {   </div>
<div class="line">                        dist = d_orr; </div>
<div class="line">                        shade=<span class="keyword">true</span>;   <span class="comment">// colorazione più scura dei muri orriz</span></div>
<div class="line">                        </div>
<div class="line">                        ntile = tile_o;</div>
<div class="line">                        off = int(fmod(xo, map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>));</div>
<div class="line">                } <span class="keywordflow">else</span> {</div>
<div class="line">                        dist = d_vert;</div>
<div class="line">                        </div>
<div class="line">                        ntile = tile_v;</div>
<div class="line">                        off = int(fmod(yv, map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)); </div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                dist = sqrt(dist);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> (i==lschermo/2)</div>
<div class="line">                        pl.<a class="code" href="structplayer__dat.html#ac3c1dd8e6cde041ef33a9638abc36fc8" title="Distanza dal muro più vicino.">dist_m</a> = dist; </div>
<div class="line">                </div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">if</span> (dist==0)</div>
<div class="line">                        dist = 0.01;</div>
<div class="line">                        </div>
<div class="line">                zbuffer[i] = dist;  <span class="comment">//aggiorno zbuffer</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">                dist = dist * cos(<a class="code" href="raycast_8cc.html#ac2200150c9f43d15c533f992f37b5f96" title="Dato un angolo in gradi lo converte in radianti.">rad</a>(<a class="code" href="raycast_8cc.html#a5b4615cd4bb62c1c29dfd7e3bb2a3739" title="Dato un numero lo riporta ad un intervallo fra 0 e 360.">to_360</a>(pl.<a class="code" href="structplayer__dat.html#ae51ef04fa403d4694a36380e54b3148d" title="Angolo in gradi.">ang</a>-angray))); <span class="comment">//tolgo distorsione</span></div>
<div class="line">                                </div>
<div class="line">                <span class="keywordtype">double</span> h_linea = (map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a> / dist) * <a class="code" href="struttura__dati_8h.html#ac135773066aa5d3223927deba36fdb2c" title="distanza del piano di proiezione dallo schermo">dist_schermo</a>;</div>
<div class="line">                </div>
<div class="line"> </div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> k=0; k&lt;h_linea; k++) {</div>
<div class="line">                </div>
<div class="line">                        <span class="keywordtype">int</span> yoff =  map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a> - map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>*k / h_linea;</div>
<div class="line">                        </div>
<div class="line">                        <span class="keywordflow">if</span> (yoff&lt;0 &amp;&amp; yoff&gt;=lschermo)</div>
<div class="line">                                <span class="keywordflow">continue</span>;</div>
<div class="line">                        </div>
<div class="line">                        <span class="keywordtype">int</span> screen_pos = <a class="code" href="struttura__dati_8h.html#af660130ebbf343c65c1bdcbb8fa23cbf" title="Altezza dello schermo.">hschermo</a>/2+h_linea/2-k;</div>
<div class="line">                        </div>
<div class="line">                        <span class="keywordflow">if</span> (screen_pos &lt; hschermo &amp;&amp; screen_pos &gt;= 0) {</div>
<div class="line">                                ALLEGRO_COLOR col = texture[ntile].<a class="code" href="structtexture__dat.html#a2d4e329432e9f424959bdb18c1b92c42" title="Matrice di colori, ovvero l&#39; immagine.">img</a>[yoff%map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>][off];</div>
<div class="line">                                </div>
<div class="line">                                col = <a class="code" href="raycast_8cc.html#af17327e8f30901ed070fd9413dfc331a" title="Conferisce un effetto di distanza ai muri scurendoli.">effetto_distanza</a>(col, dist);</div>
<div class="line">                                </div>
<div class="line">                                <span class="keywordflow">if</span> (shade) {</div>
<div class="line">                                        col.r /= 1.5;</div>
<div class="line">                                        col.g /= 1.5;</div>
<div class="line">                                        col.b /= 1.5;</div>
<div class="line">                                }</div>
<div class="line">                                </div>
<div class="line">                                </div>
<div class="line">                                </div>
<div class="line">                                render[screen_pos][i] = col; </div>
<div class="line">                        }</div>
<div class="line">                }</div>
<div class="line">                        </div>
<div class="line"></div>
<div class="line">                </div>
<div class="line">                        </div>
<div class="line">                <span class="comment">//rendering pavimento e soffitto   </span></div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=<a class="code" href="struttura__dati_8h.html#af660130ebbf343c65c1bdcbb8fa23cbf" title="Altezza dello schermo.">hschermo</a>/2+h_linea/2-1;j&gt;=0 &amp;&amp; j&lt;<a class="code" href="struttura__dati_8h.html#af660130ebbf343c65c1bdcbb8fa23cbf" title="Altezza dello schermo.">hschermo</a>; j++) {</div>
<div class="line">        </div>
<div class="line">                        <span class="keywordtype">double</span> deltaPJ =  j- hschermo/2;</div>
<div class="line">                        <span class="keywordtype">double</span> p_ydist = pl.<a class="code" href="structplayer__dat.html#a050afd4135a3b8b9b64c34e76c1639aa" title="Altezza del giocatore.">h</a> / deltaPJ * <a class="code" href="struttura__dati_8h.html#ac135773066aa5d3223927deba36fdb2c" title="distanza del piano di proiezione dallo schermo">dist_schermo</a>; </div>
<div class="line">                        <span class="keywordtype">double</span> p_dist = p_ydist / cos(<a class="code" href="raycast_8cc.html#ac2200150c9f43d15c533f992f37b5f96" title="Dato un angolo in gradi lo converte in radianti.">rad</a>(angray-pl.<a class="code" href="structplayer__dat.html#ae51ef04fa403d4694a36380e54b3148d" title="Angolo in gradi.">ang</a>));</div>
<div class="line">                </div>
<div class="line">                </div>
<div class="line">                                        </div>
<div class="line">                        <span class="keywordtype">int</span> px = pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a> + p_dist*cos(-1*<a class="code" href="raycast_8cc.html#ac2200150c9f43d15c533f992f37b5f96" title="Dato un angolo in gradi lo converte in radianti.">rad</a>(angray));</div>
<div class="line">                        <span class="keywordtype">int</span> py = pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a> + p_dist*sin(-1*<a class="code" href="raycast_8cc.html#ac2200150c9f43d15c533f992f37b5f96" title="Dato un angolo in gradi lo converte in radianti.">rad</a>(angray));</div>
<div class="line">                        </div>
<div class="line">                                        </div>
<div class="line">                        px&lt;0 ? px = -px : px;</div>
<div class="line">                        py&lt;0 ? py = -py : py;</div>
<div class="line">                        </div>
<div class="line">                        </div>
<div class="line">                        px = px % map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>; <span class="comment">//calcolo il pixel da pescare</span></div>
<div class="line">                        py = py % map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>;</div>
<div class="line">                                 </div>
<div class="line">                        <span class="comment">//pavimento:</span></div>
<div class="line">                        render[j][i] = <a class="code" href="raycast_8cc.html#af17327e8f30901ed070fd9413dfc331a" title="Conferisce un effetto di distanza ai muri scurendoli.">effetto_distanza</a>(texture[0].img[py][px],p_dist);</div>
<div class="line">                        <span class="comment">//soffitto:</span></div>
<div class="line">                        render[hschermo-j-1][i] = <a class="code" href="raycast_8cc.html#af17327e8f30901ed070fd9413dfc331a" title="Conferisce un effetto di distanza ai muri scurendoli.">effetto_distanza</a>(texture[1].img[py][px],p_dist);  </div>
<div class="line">                        </div>
<div class="line">                } </div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line">                </div>
<div class="line">        <span class="comment">//disegno sprite</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="comment">//calcolo le sprite che sono da disegnare</span></div>
<div class="line">        <span class="keywordtype">int</span> da_disegnare[nem.<a class="code" href="structnemici__dat.html#ab9f6af23f8e24915ab8e328a76d3c930" title="Numero nemici.">num_nemici</a>];</div>
<div class="line">        <span class="keywordtype">int</span> n_da_disegnare=0;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n &lt; nem.<a class="code" href="structnemici__dat.html#ab9f6af23f8e24915ab8e328a76d3c930" title="Numero nemici.">num_nemici</a>; n++) {</div>
<div class="line">                <span class="keywordtype">double</span> xsprite = nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n].<a class="code" href="structnemico__dat.html#a8671e18e611267e6f5a0a33a0aa96371" title="Coordinata x.">x</a>;</div>
<div class="line">                <span class="keywordtype">double</span> ysprite = nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n].<a class="code" href="structnemico__dat.html#ae77c14ff4bea0943f352d4f7eec20ddb" title="Coordinata y.">y</a>; </div>
<div class="line">                nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n].<a class="code" href="structnemico__dat.html#a41f88af2ac81498e51823af81a90057a" title="true se è stato visto">vis</a> = <span class="keyword">false</span>;</div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">if</span>(blocchi_in_vista[<span class="keywordtype">int</span>(ysprite/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)][<span class="keywordtype">int</span>(xsprite/map.<a class="code" href="structmappa__dat.html#a66d74a7d20b0999f0840af9044c91d60" title="dimensione blocchi">u</a>)]) {          </div>
<div class="line">                        da_disegnare[n_da_disegnare] = n;</div>
<div class="line">                        n_da_disegnare++;</div>
<div class="line">                        nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n].<a class="code" href="structnemico__dat.html#a41f88af2ac81498e51823af81a90057a" title="true se è stato visto">vis</a> = <span class="keyword">true</span>;</div>
<div class="line">                        nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n].<a class="code" href="structnemico__dat.html#a7eaec74f66484b6bd53d377038d5cdcd" title="se true insegue il giocatore">insegui</a> = <span class="keyword">true</span>;   </div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">//calcolo distanze</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n &lt; n_da_disegnare; n++) {</div>
<div class="line">                <span class="keywordtype">int</span> n_spr = da_disegnare[n];</div>
<div class="line">                nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n_spr].<a class="code" href="structnemico__dat.html#a4df41dde8f4d6a21750610b919487484" title="Distanza dal giocatore.">dist</a> = </div>
<div class="line">                        sqrt(   pow(pl.<a class="code" href="structplayer__dat.html#af66b2d7f7e5c9a0c093b4ae92d8f0c03" title="Coordinata x.">x</a> - nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n_spr].<a class="code" href="structnemico__dat.html#a8671e18e611267e6f5a0a33a0aa96371" title="Coordinata x.">x</a>,2) + </div>
<div class="line">                                        pow (pl.<a class="code" href="structplayer__dat.html#a8fc56837f576bfac7ee926e0aedefcf2" title="Coordinata y.">y</a> - nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[n_spr].<a class="code" href="structnemico__dat.html#ae77c14ff4bea0943f352d4f7eec20ddb" title="Coordinata y.">y</a>,2)              );</div>
<div class="line"></div>
<div class="line">        }       </div>
<div class="line">        </div>
<div class="line">        <span class="comment">//metto le sprite in fila in base alla distanza</span></div>
<div class="line">        <a class="code" href="raycast_8cc.html#ac84354a5d9d83509fa701d4bc251e0ae" title="Ordina i nemici in base alla distanza dal giocatore.">sort_nemici</a>(da_disegnare, n_da_disegnare, nem);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">//disegno le sprite in fila</span></div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> n=0; n &lt; n_da_disegnare; n++) {</div>
<div class="line">                <span class="keywordtype">int</span> n_spr = da_disegnare[n];</div>
<div class="line">                <a class="code" href="raycast_8cc.html#a66cd3c9531caaf3edd8212d0450c5b06" title="Disegna le sprite dei nemici sulla render matrix.">disegna_sprite</a>(n_spr, pl, nem, map, zbuffer, render);</div>
<div class="line">    }</div>
<div class="line">                        </div>
<div class="line">        </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac84354a5d9d83509fa701d4bc251e0ae"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void sort_nemici </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>a</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structnemici__dat.html">nemici_dat</a> &amp;&#160;</td>
          <td class="paramname"><em>nem</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Ordina i nemici in base alla distanza dal giocatore. </p>
<p>questa funzione implementa un algoritmo di sorting molto semplice (bubble sort) in quanto i nemici da ordinare sono di un ordine di grandezza basso. </p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">bool</span> scambio=<span class="keyword">true</span>;</div>
<div class="line">        <span class="keywordflow">while</span> (scambio)</div>
<div class="line">        {       </div>
<div class="line">                scambio=<span class="keyword">false</span>;</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;n; i++)</div>
<div class="line">                {</div>
<div class="line">                        <span class="keywordflow">if</span> (nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[a[i]].<a class="code" href="structnemico__dat.html#a4df41dde8f4d6a21750610b919487484" title="Distanza dal giocatore.">dist</a>&gt;nem.<a class="code" href="structnemici__dat.html#a559652c8265efa3bcae93c6dace103c1" title="Puntatore ad array di nemici.">nemico</a>[a[i-1]].<a class="code" href="structnemico__dat.html#a4df41dde8f4d6a21750610b919487484" title="Distanza dal giocatore.">dist</a>) {            </div>
<div class="line">                                <span class="keywordtype">int</span> temp = a[i];</div>
<div class="line">                                a[i] = a[i-1];</div>
<div class="line">                                a[i-1] = temp;</div>
<div class="line">                                scambio=<span class="keyword">true</span>;</div>
<div class="line">                        }       </div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5b4615cd4bb62c1c29dfd7e3bb2a3739"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double to_360 </td>
          <td>(</td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>ang</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dato un numero lo riporta ad un intervallo fra 0 e 360. </p>
<p>Parametri: ang numero </p>
<div class="fragment"><div class="line">{</div>
<div class="line">        ang &gt;= 360? ang=ang-360 : ang;</div>
<div class="line">        ang &lt; 0 ? ang =ang+360 : ang;</div>
<div class="line">        <span class="keywordflow">return</span> ang;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generato Gio 4 Set 2014 12:44:47 per Zombie-Kaze da &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
